//@version=5
strategy(title="Stochastic RSI Strategy with Moving Averages", shorttitle="Stoch RSI Strategy", overlay=true)

// Input settings for Moving Averages
len1 = input.int(20, minval=1, title="MA Length 1")
len2 = input.int(50, minval=1, title="MA Length 2")
src1 = input(close, title="Source 1")
src2 = input(close, title="Source 2")

// Calculate Moving Averages
ma1 = ta.sma(src1, len1)
ma2 = ta.sma(src2, len2)

// Plot Moving Averages
plot(ma1, color=color.blue, title="MA 20")
plot(ma2, color=color.red, title="MA 50")

// Input settings for Stochastic RSI
smoothK = input.int(3, "K", minval=1)
smoothD = input.int(3, "D", minval=1)
lengthRSI = input.int(14, "RSI Length", minval=1)
lengthStoch = input.int(14, "Stochastic Length", minval=1)
src = input(close, title="RSI Source")
rsi1 = ta.rsi(src, lengthRSI)
k = ta.sma(ta.stoch(rsi1, rsi1, rsi1, lengthStoch), smoothK)
d = ta.sma(k, smoothD)

// Plot Stochastic RSI
plot(k, "K", color=#2962FF)
plot(d, "D", color=#FF6D00)
h0 = hline(80, "Upper Band", color=#787B86)
hline(50, "Middle Band", color=color.new(#787B86, 50))
h1 = hline(20, "Lower Band", color=#787B86)
fill(h0, h1, color=color.rgb(33, 150, 243, 90), title="Background")

// Buy Condition
buyCondition = ta.crossover(k, d) and k < 50 and ma1 > ma2
if (buyCondition)
    strategy.entry("Buy", strategy.long)

// Sell Condition
sellCondition = ta.crossunder(k, d) and k > 50 and ma1 < ma2
if (sellCondition)
    strategy.entry("Sell", strategy.short)

// Exit Conditions
exitConditionLong = (close <= ma2) or sellCondition
exitConditionShort = (close >= ma2) or buyCondition

if (exitConditionLong and strategy.position_size > 0)
    strategy.close("Buy")

if (exitConditionShort and strategy.position_size < 0)
    strategy.close("Sell")
